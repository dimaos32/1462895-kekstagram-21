(()=>{"use strict";(()=>{const e={symbol:["символ","символа","символов"]};window.utils={Key:{ENTER:"Enter",ESCAPE:"Escape"},checkExtensionAccordance:(e,t)=>t.some((t=>e.name.toLowerCase().endsWith(t))),getQEndings:(t=1,o)=>{if(t%100<11||t%100>14){if(t%10==1)return`${t} ${e[o][0]}`;if(t%10>1&&t%10<5)return`${t} ${e[o][1]}`}return`${t} ${e[o][2]}`},getRandomArrayElements:(e,t=1)=>{let o=e.slice(),n=[];for(let e=0;e<o.length&&e<t;e++){const t=e+Math.floor(Math.random()*(o.length-e));n.push(o[t]);const r=o[t];o[t]=o[e],o[e]=r}return n},addId:e=>e.map(((e,t)=>Object.assign({},e,{id:""+t}))),debounce:(e,t=500)=>{let o=null;return function(...n){o&&window.clearTimeout(o),o=window.setTimeout((()=>{e(...n)}),t)}}}})(),(()=>{const e="https://21.javascript.pages.academy/kekstagram",t=(e,t,o,n,r)=>{const s=new XMLHttpRequest;s.responseType="json",s.timeout=1e4,s.open(e,t),"POST"===e?s.send(r):s.send(),s.addEventListener("load",(()=>{200===s.status?o(s.response):n(`Статус ответа: ${s.status} ${s.statusText}`)})),s.addEventListener("error",(()=>{n("Произошла ошибка соединения")})),s.addEventListener("timeout",(()=>{n(`Запрос не успел выполниться за ${s.timeout/1e3} с`)}))};window.backend={load:(o,n)=>{t("GET",e+"/data",o,n)},send:(o,n,r)=>{t("POST",e,n,r,o)}}})(),(()=>{const e=document.querySelector("body"),t=document.querySelector(".pictures"),o=document.querySelector(".big-picture"),n=o.querySelector(".comments-shown"),r=o.querySelector(".comments-count"),s=o.querySelector(".social__comments"),c=o.querySelector(".social__comments-loader"),l=o.querySelector(".big-picture__cancel"),i=document.querySelector("#picture").content.querySelector(".picture"),a=document.querySelector("#social__comment").content.querySelector(".social__comment");t.addEventListener("click",(t=>{(t=>{t.target.closest(".picture")&&(t.preventDefault(),(t=>{const i=window.photos.find((e=>e.id===t)),{comments:d,description:u,likes:m,url:v}=i,y=e=>{const t=a.cloneNode(!0);t.querySelector(".social__picture").src=d[e].avatar,t.querySelector(".social__picture").alt=d[e].name,t.querySelector(".social__text").textContent=d[e].message,s.append(t)},p=()=>{const e=parseInt(n.textContent,10),t=parseInt(r.textContent,10),o=t-e<5?t-e:5;for(let t=e;t<e+o;t++)y(t);n.textContent=""+(e+o),n.textContent===r.textContent&&c.classList.add("hidden")},_=()=>{p()},f=()=>{o.classList.add("hidden"),e.classList.remove("modal-open"),c.classList.remove("hidden"),c.removeEventListener("click",_),l.removeEventListener("click",w),document.removeEventListener("keydown",g)},w=()=>{f()},g=e=>{e.key===window.utils.Key.ESCAPE&&(e.preventDefault(),f())};o.querySelector(".big-picture__img img").src=v,o.querySelector(".social__caption").textContent=u,o.querySelector(".likes-count").textContent=""+m,n.textContent=0,r.textContent=""+d.length,s.innerHTML="",p(),o.classList.remove("hidden"),e.classList.add("modal-open"),c.addEventListener("click",_),l.addEventListener("click",w),document.addEventListener("keydown",g)})(t.target.closest(".picture").dataset.id))})(t)})),window.pictures={renderPhotos:e=>{const o=document.createDocumentFragment();t.querySelectorAll(".picture").forEach((e=>{e.remove()})),e.forEach((e=>{o.append((e=>{const t=i.cloneNode(!0);return t.dataset.id=e.id,t.querySelector(".picture__img").src=e.url,t.querySelector(".picture__img").alt=e.description,t.querySelector(".picture__comments").textContent=""+e.comments.length,t.querySelector(".picture__likes").textContent=""+e.likes,t})(e))})),t.append(o)}}})(),(()=>{const e=100,t=document.querySelector(".img-upload__overlay"),o=t.querySelector(".img-upload__preview img"),n=t.querySelector(".effects__list"),r=t.querySelector("#effect-none"),s=t.querySelector(".effect-level"),c=t.querySelector(".effect-level__value"),l=t.querySelector(".effect-level__pin"),i=t.querySelector(".effect-level__depth");let a,d="none";const u={none:()=>{o.className="",o.style.filter=""},chrome:t=>{const n=0+1*t/e;o.className="effects__preview--chrome",o.style.filter=`grayscale(${n})`},sepia:t=>{const n=0+1*t/e;o.className="effects__preview--sepia",o.style.filter=`sepia(${n})`},marvin:t=>{const n=0+100*t/e;o.className="effects__preview--marvin",o.style.filter=`invert(${n}%)`},phobos:t=>{const n=Math.round(0+3*t/e);o.className="effects__preview--phobos",o.style.filter=`blur(${n}px)`},heat:t=>{const n=1+2*t/e;o.className="effects__preview--heat",o.style.filter=`brightness(${n})`}},m=()=>{a=e,l.style.left="100%",i.style.width=l.style.left};n.addEventListener("change",(e=>{m(),d=e.target.value,u[d](a),s.style.display="block","none"===d&&(s.style.display="none")})),l.addEventListener("mousedown",(t=>{t.preventDefault();let o=t.clientX;const n=t=>{t.preventDefault();const n=t.clientX-o;o=t.clientX,a+=n*e/453,a<0&&(a=0),a>e&&(a=e),u[d](a),l.style.left=a+"%",i.style.width=l.style.left},r=e=>{e.preventDefault(),c.value=Math.round(a),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",r)})),window.effects={resetValue:m,reset:()=>{r.checked=!0}}})(),(()=>{const e=/^#[\wА-Яа-я]{1,19}$/,t=document.querySelector("body"),o=t.querySelector("main"),n=document.querySelector(".img-upload__form"),r=n.querySelector(".img-upload__overlay"),s=r.querySelector("#upload-cancel"),c=r.querySelector(".scale__control--smaller"),l=r.querySelector(".scale__control--bigger"),i=r.querySelector(".scale__control--value"),a=r.querySelector(".img-upload__preview img"),d=r.querySelector(".text__description"),u=r.querySelector(".text__hashtags"),m=document.querySelector("#success").content.querySelector(".success"),v=document.querySelector("#error").content.querySelector(".error"),y=(e=1)=>{a.style="transform: scale("+e},p=()=>{y(),i.value="100%",window.effects.resetValue(),window.effects.reset(),a.className="",a.style.filter="",d.value="",u.value="",n.reset(),r.classList.add("hidden"),t.classList.remove("modal-open")},_=e=>{const t=e.cloneNode(!0),n=()=>{t.remove(),t.removeEventListener("click",n),document.removeEventListener("keydown",r)},r=e=>{e.key===window.utils.Key.ESCAPE&&(t.remove(),document.removeEventListener("keydown",r))};p(),o.append(t),t.addEventListener("click",n),document.addEventListener("keydown",r)},f=()=>{_(m)},w=()=>{_(v)};s.addEventListener("click",(()=>{p()})),document.addEventListener("keydown",(e=>{e.key===window.utils.Key.ESCAPE&&d!==document.activeElement&&u!==document.activeElement&&(e.preventDefault(),p())})),c.addEventListener("click",(()=>{(()=>{const e=parseInt(i.value,10);e>25&&(i.value=e-25+"%",y((e-25)/100))})()})),l.addEventListener("click",(()=>{(()=>{const e=parseInt(i.value,10);e<100&&(i.value=e+25+"%",y((e+25)/100))})()})),u.addEventListener("input",(()=>{const t=(t=>{const o=t.trim().toLowerCase().split(" ").sort();if(o.length>5)return{value:!1,reason:"QUANTITY"};for(let n=0;n<o.length;n++){if(!e.test(o[n])&&t)return{value:!1,reason:"RE"};if(n>0&&o[n]===o[n-1])return{value:!1,reason:"DOUBLING"}}return{value:!0}})(u.value);if(t.value)u.classList.remove("text__not-valid"),u.setCustomValidity("");else switch(u.classList.add("text__not-valid"),t.reason){case"QUANTITY":u.setCustomValidity("Укажите не более 5 хэш-тегов");break;case"RE":u.setCustomValidity("Каждый хэш-тег должен начинаться с символа # (решётка), может состоять из букв, чисел и _ (символ подчеркивания), хеш-тег не может состоять только из одной решётки, максимальная длина одного хэш-тега 20 символов, включая решётку");break;case"DOUBLING":u.setCustomValidity("Один и тот же хэш-тег не может быть использован дважды, хэш-теги нечувствительны к регистру (#ХэшТег и #хэштег считаются одним и тем же тегом)")}u.reportValidity()})),d.addEventListener("input",(()=>{const e=d.value.length;if(e>140){const t=e-140;d.classList.add("text__not-valid"),d.setCustomValidity("Допустимая длинна комментария - 140 символов. Удалите "+window.utils.getQEndings(t,"symbol"))}else d.classList.remove("text__not-valid"),d.setCustomValidity("");d.reportValidity()})),n.addEventListener("submit",(e=>{e.preventDefault(),window.backend.send(new FormData(n),f,w)}))})(),(()=>{const e={"filter-default":()=>window.photos,"filter-random":()=>window.utils.getRandomArrayElements(window.photos,10),"filter-discussed":()=>window.photos.slice().sort(((e,t)=>t.comments.length-e.comments.length))},t=document.querySelector(".img-filters__form");t.addEventListener("click",window.utils.debounce((o=>{t.querySelector(".img-filters__button--active").classList.remove("img-filters__button--active"),o.target.classList.add("img-filters__button--active"),window.pictures.renderPhotos(e[o.target.id]())})))})(),(()=>{const e=["gif","jpg","jpeg","png"],t=document.querySelector("body"),o=document.querySelector(".img-upload__form"),n=o.querySelector("#upload-file"),r=o.querySelector(".img-upload__preview img"),s=o.querySelector(".img-upload__overlay"),c=document.querySelector(".img-filters");window.backend.load((e=>{window.photos=window.utils.addId(e),window.pictures.renderPhotos(window.photos),c.classList.remove("img-filters--inactive")}),(e=>{const t=document.createElement("div");t.classList.add("on-error-message"),t.textContent=e,document.body.insertAdjacentElement("afterbegin",t)})),n.addEventListener("change",(o=>{const n=o.target.files[0];if(window.utils.checkExtensionAccordance(n,e)){const e=new FileReader;e.addEventListener("load",(()=>{s.classList.remove("hidden"),t.classList.add("modal-open"),r.src=e.result})),e.readAsDataURL(n)}}))})()})();
//# sourceMappingURL=main_bundle.js.map